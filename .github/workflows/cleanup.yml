name: Cleanup Cron Job

on:
  # Schedule: Run every 5 minutes
  schedule:
    - cron: '*/5 * * * *'
  
  # Allow manual trigger from GitHub UI
  workflow_dispatch:
  
  # Optional: Run on code push (for testing)
  push:
    branches: [ main ]

jobs:
  cleanup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Run Cleanup Script
      run: |
        echo "ğŸ• Starting cleanup at $(date)"
        echo "ğŸ”— Calling: https://1osbr3aker.rf.gd/cron/cleanup.php"
        
        # Call your cleanup endpoint
        response=$(curl -s -w "\n%{http_code}" "https://1osbr3aker.rf.gd/cron/cleanup.php")
        
        # Split response and status code
        http_code=$(echo "$response" | tail -n1)
        body=$(echo "$response" | head -n -1)
        
        echo "ğŸ“Š HTTP Response Code: $http_code"
        echo "ğŸ“ Response Body:"
        echo "$body"
        
        # Check if successful (200 OK)
        if [ "$http_code" -eq 200 ] || [ "$http_code" -eq 000 ]; then
          echo "âœ… Cleanup successful!"
          exit 0
        else
          echo "âŒ Cleanup failed with HTTP $http_code"
          exit 1
        fi
    
    - name: Notify Success
      if: success()
      run: echo "ğŸ‰ Cron job completed successfully at $(date)"
    
    - name: Notify Failure
      if: failure()
      run: echo "âŒ Cron job failed at $(date). Check logs above."
