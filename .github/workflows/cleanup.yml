name: Cleanup Cron Job

on:
  # Allow manual trigger
  workflow_dispatch:
  
  # Run on push for testing
  push:
    branches: [ main ]

jobs:
  test-connection:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Check repository
      run: echo "âœ… Repository checked out successfully"
    
    - name: Test Internet Connection
      run: |
        echo "ðŸŒ Testing basic internet connectivity..."
        ping -c 3 google.com
        echo "âœ… Internet connection OK"
    
    - name: Test DNS Resolution
      run: |
        echo "ðŸ” Testing DNS for your domain..."
        nslookup 1osbr3aker.rf.gd
        echo "âœ… DNS resolution OK"
    
    - name: Test HTTPS Access
      run: |
        echo "ðŸ”— Testing HTTPS access to your site..."
        curl -I "https://1osbr3aker.rf.gd/" --max-time 10
        echo "âœ… HTTPS access OK"
    
    - name: Test Cleanup Endpoint
      run: |
        echo "ðŸ”„ Testing cleanup endpoint..."
        echo "URL: https://1osbr3aker.rf.gd/cron/cleanup.php"
        
        # Try with verbose output
        curl -v "https://1osbr3aker.rf.gd/cron/cleanup.php" --max-time 30 2>&1 | head -50
        
        # Also try with simpler options
        echo "--- Alternative test ---"
        curl -s -o /dev/null -w "Status: %{http_code}\nTime: %{time_total}s\n" \
          "https://1osbr3aker.rf.gd/cron/cleanup.php" --max-time 10
    
    - name: Create Status File
      run: |
        echo "ðŸ“ Creating test results..."
        date > test-result.txt
        echo "Test completed at $(date)" >> test-result.txt
    
    - name: Upload Test Results
      uses: actions/upload-artifact@v3
      with:
        name: test-results
        path: test-result.txt
